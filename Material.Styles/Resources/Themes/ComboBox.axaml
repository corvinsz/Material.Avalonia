<ResourceDictionary xmlns="https://github.com/avaloniaui"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:converters="clr-namespace:Material.Styles.Converters"
                    xmlns:parameters="clr-namespace:Material.Styles.Converters.Parameters"
                    xmlns:assists="clr-namespace:Material.Styles.Assists"
                    xmlns:controls="clr-namespace:Material.Styles.Controls"
                    xmlns:system="clr-namespace:System;assembly=netstandard">
  <Design.PreviewWith>
    <Border Padding="20" Width="360">
      <StackPanel VerticalAlignment="Center">
        <ComboBox PlaceholderText="Test">
          <ComboBox.Items>
            <ComboBoxItem Content="Item 1" />
          </ComboBox.Items>
        </ComboBox>
        <ComboBox Theme="{StaticResource MaterialFilledComboBox}" PlaceholderText="Test">
          <ComboBox.Items>
            <ComboBoxItem Content="Item 1" />
          </ComboBox.Items>
        </ComboBox>
        <ComboBox Theme="{StaticResource MaterialOutlineComboBox}" PlaceholderText="Test">
          <ComboBox.Items>
            <ComboBoxItem Content="Item 1" />
          </ComboBox.Items>
        </ComboBox>
      </StackPanel>
    </Border>
  </Design.PreviewWith>


  <converters:RectHollowClipConverter x:Key="RectangleHollowGeometry" />
  <parameters:RectHollowClipParameter x:Key="OutlineTextBoxClippingParameter" Margin="8,0" Offset="4,-8" />

  <!-- TODO: Rework combobox styles-->
  <!-- Default -->
  <ControlTheme x:Key="MaterialComboBox" TargetType="ComboBox">
    <Setter Property="Background" Value="Transparent" />
    <Setter Property="PlaceholderForeground" Value="{DynamicResource MaterialBodyBrush}" />
    <Setter Property="HorizontalContentAlignment" Value="Stretch" />
    <Setter Property="HorizontalAlignment" Value="Stretch" />
    <Setter Property="VerticalAlignment" Value="Center" />
    <Setter Property="BorderBrush" Value="Transparent" />
    <Setter Property="BorderThickness" Value="0" />
    <Setter Property="Padding" Value="8,4" />
    <Setter Property="ClipToBounds" Value="False" />
    <Setter Property="Template">
      <ControlTemplate>
        <Border Name="PART_RootBorder"
                Background="{TemplateBinding Background}"
                BorderBrush="{TemplateBinding BorderBrush}"
                BorderThickness="{TemplateBinding BorderThickness}"
                CornerRadius="{TemplateBinding CornerRadius}">
          <DataValidationErrors Name="PART_DataValidation">
            
            
            
            <Panel Name="PART_RootPanel">
              <Grid ColumnDefinitions="*, Auto, Auto">
                <Panel Grid.Column="0">
                  <Border Name="PART_BackgroundField" />

                  <Panel Name="PART_InnerPanel" HorizontalAlignment="Left">
                    <TextBlock Name="PART_PlaceholderText"
                               Text="{TemplateBinding PlaceholderText}"
                               VerticalAlignment="Center"
                               Foreground="{TemplateBinding PlaceholderForeground}" />

                    <ContentPresenter Name="PART_ContentPresenter"
                                      Content="{TemplateBinding SelectionBoxItem}"
                                      ContentTemplate="{TemplateBinding ItemTemplate}" />
                  </Panel>

                  <Border Name="PART_LabelRootBorder">
                    <TextBlock Name="PART_LabelText"
                               Text="{TemplateBinding (assists:ComboBoxAssist.Label)}" />
                  </Border>
                </Panel>

                <Button Name="PART_ClearButton"
                        Grid.Column="1"
                        Theme="{StaticResource ClearTextBoxButton}"
                        Command="{Binding $parent[TextBox].Clear}" />

                <Border Name="splitBorder"
                        Grid.Column="2"
                        Margin="16 8"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center"
                        BorderBrush="Transparent"
                        BorderThickness="0">
                  <Path Name="arrow"
                        Width="8" Height="8"
                        Stretch="Uniform"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center"
                        Data="M7,10L12,15L17,10H7Z"
                        Fill="{DynamicResource MaterialTextBoxBorderBrush}" />
                </Border>
              </Grid>


              <controls:MaterialUnderline Name="PART_Underline"
                                          Theme="{StaticResource MaterialUnderlineY}" />

              <Panel Name="PART_PopupContainer">
                <Popup Name="PART_Popup"
                       IsLightDismissEnabled="True"
                       IsOpen="{TemplateBinding IsDropDownOpen, Mode=TwoWay}">
                  <controls:Card Name="PART_Card"
                                 MaxHeight="{TemplateBinding MaxDropDownHeight}"
                                 MinWidth="{Binding Bounds.Width, RelativeSource={RelativeSource TemplatedParent}}">
                    <ScrollViewer Name="PART_ScrollViewer">
                      <ItemsPresenter Name="PART_ItemsPresenter"
                                      ItemsPanel="{TemplateBinding ItemsPanel}" />
                    </ScrollViewer>
                  </controls:Card>
                </Popup>
              </Panel>
            </Panel>

          </DataValidationErrors>
        </Border>
      </ControlTemplate>
    </Setter>

    <Style Selector="^ /template/ Panel#PART_RootPanel">
      <Setter Property="Height" Value="48" />
    </Style>

    <Style Selector="^ /template/ controls|MaterialUnderline#PART_Underline">
      <Setter Property="VerticalAlignment" Value="Bottom" />
    </Style>

    <Style Selector="^:focus-within /template/ controls|MaterialUnderline#PART_Underline,
                     ^[IsDropDownOpen=True] /template/ controls|MaterialUnderline#PART_Underline">
      <Setter Property="IsActive" Value="True" />
    </Style>

    <Style Selector="^:pointerover /template/ controls|MaterialUnderline#PART_Underline">
      <Setter Property="IsHovered" Value="True" />
    </Style>

    <Style Selector="^ /template/ TextBlock#PART_PlaceholderText">
      <Setter Property="Opacity" Value="0" />
    </Style>

    <Style Selector="^[SelectedIndex=-1] /template/ TextBlock#PART_PlaceholderText">
      <Setter Property="Opacity" Value="1" />
    </Style>

    <Style Selector="^ /template/ Popup#PART_Popup">
      <Setter Property="Margin" Value="6,0" />
    </Style>

    <Style Selector="^ /template/ Panel#PART_PopupContainer">
      <Setter Property="Margin" Value="-6,0" />
    </Style>

    <Style Selector="^ /template/ Popup#PART_Popup > controls|Card#PART_Card">
      <Setter Property="Padding" Value="0" />
      <Setter Property="Margin" Value="6,0,6,6" />
      <Setter Property="CornerRadius" Value="0,0,4,4" />
    </Style>
  </ControlTheme>

  <ControlTheme x:Key="{x:Type ComboBox}" TargetType="ComboBox"
                BasedOn="{StaticResource MaterialComboBox}" />


  <!-- Filled -->
  <ControlTheme x:Key="MaterialFilledComboBox"
                TargetType="ComboBox"
                BasedOn="{StaticResource MaterialComboBox}">
    <Setter Property="Background" Value="{DynamicResource MaterialTextFieldBoxBackgroundBrush}" />
    <Setter Property="ContextFlyout" Value="{StaticResource DefaultTextBoxMenuFlyout}" />
    <Setter Property="Padding" Value="16,8" />

    <Style Selector="^[IsDropDownOpen=true] /template/ TextBlock#floatingWatermark">
      <Setter Property="Margin" Value="10,10,1,1" />
      <Setter Property="RenderTransform" Value="scale(0.75)" />
    </Style>
    <Style Selector="^[IsDropDownOpen=false] /template/ TextBlock#floatingWatermark">
      <Setter Property="Margin" Value="10,20,1,1" />
    </Style>
  </ControlTheme>


  <!-- Outline -->
  <ControlTheme x:Key="MaterialOutlineComboBox" TargetType="ComboBox"
                BasedOn="{StaticResource MaterialComboBox}">
    <Setter Property="BorderBrush" Value="{DynamicResource MaterialBodyBrush}" />
    <Setter Property="Background" Value="Transparent" />
    <Setter Property="ContextFlyout" Value="{StaticResource DefaultTextBoxMenuFlyout}" />
    <Setter Property="Padding" Value="16,8" />
    
    <Style
      Selector="^:not(.no-transitions) /template/ TextBlock#floatingWatermark,
                ^:not(.no-transitions) /template/ Border#watermarkRoot">
      <Setter Property="Transitions">
        <Transitions>
          <ThicknessTransition Duration="0:0:0.25" Property="Margin" Easing="CubicEaseOut" />
          <TransformOperationsTransition Property="RenderTransform" Duration="0:0:0.25" Easing="CubicEaseOut" />
        </Transitions>
      </Setter>
    </Style>

    <Style Selector="^ /template/ Grid#PART_RootBorder">
      <Setter Property="MinHeight" Value="52" />
    </Style>

    <Style
      Selector="^:focus-within:not(ComboBox.Outline[SelectedIndex=-1]) /template/ Border#watermarkRoot,
                ^:focus-within /template/ Border#watermarkRoot,
                ^:not(ComboBox.Outline[SelectedIndex=-1]) /template/ Border#watermarkRoot">
      <Setter Property="Margin" Value="14,-8,1,1" />
      <Setter Property="RenderTransform" Value="scale(0.75)" />
    </Style>

    <Style Selector="^[SelectedIndex=-1]:not(:focus-within) /template/ Border#watermarkRoot">
      <Setter Property="Margin" Value="10,14,1,1" />
      <Setter Property="RenderTransform" Value="scale(1)" />
    </Style>

    <Style Selector="^">
      <Setter Property="BorderThickness" Value="1" />
    </Style>

    <Style Selector="^:focus-within">
      <Setter Property="BorderBrush" Value="{DynamicResource MaterialPrimaryMidBrush}" />
      <Setter Property="BorderThickness" Value="2" />
    </Style>
  </ControlTheme>
</ResourceDictionary>